<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Send Time & Device Info</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 24px; max-width: 720px; }
    button { padding: 10px 16px; margin-right: 10px; }
    #status { margin-top: 12px; line-height: 1.4; }
    .small { color:#555; font-size: 14px; }
  </style>
</head>
<body>
  <h1>Send Time & Device Info</h1>
  <p class="small">
    Tap “Send Info” to share your current time and device version.
  </p>
  <button id="send">Send Info</button>
  <div id="status">Waiting…</div>
  <script>
    const statusEl = document.getElementById("status");
    const sendBtn = document.getElementById("send");
    const API_URL = "/api/sendMail";

    function getOSVersion() {
      const ua = navigator.userAgent;
      if (/android/i.test(ua)) {
        const match = ua.match(/Android\s([0-9\.]+)/i);
        return match ? `Android ${match[1]}` : "Android";
      }
      if (/iPhone|iPad|iPod/i.test(ua)) {
        const match = ua.match(/OS (\d+_\d+(_\d+)?)/i);
        return match ? `iOS ${match[1].replace(/_/g, ".")}` : "iOS";
      }
      if (/Windows NT/i.test(ua)) {
        const match = ua.match(/Windows NT ([0-9\.]+)/i);
        if (match) {
          switch (match[1]) {
            case "10.0": return "Windows 10/11";
            case "6.3": return "Windows 8.1";
            case "6.2": return "Windows 8";
            case "6.1": return "Windows 7";
            default: return `Windows NT ${match[1]}`;
          }
        }
        return "Windows";
      }
      if (/Mac OS X/i.test(ua)) {
        const match = ua.match(/Mac OS X ([0-9_\.]+)/i);
        return match ? `macOS ${match[1].replace(/_/g, ".")}` : "macOS";
      }
      return "Unknown";
    }

    sendBtn.onclick = async () => {
      statusEl.textContent = "Sending…";
      const timestamp = new Date().toISOString();
      const osVersion = getOSVersion();

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ timestamp, osVersion })
        });
        const text = await res.text();
        if (!res.ok) {
          statusEl.textContent = `Failed (${res.status}): ${text}`;
          return;
        }
        statusEl.innerHTML = `<b>Info sent!</b><br>Time: ${timestamp}<br>Device: ${osVersion}`;
      } catch (e) {
        statusEl.textContent = "Network error. Try again.";
      }
    };
  </script>
</body>
</html>
