<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Find My Kid</title>

  <!-- 1) Include EmailJS SDK -->
  <script src="https://cdn.emailjs.com/sdk/3.2.0/email.min.js"></script>
  <script>
    // 2) Initialize with YOUR actual User ID:
    emailjs.init("SXzjF2CNLbzgqoKEH");
  </script>
</head>

<body>
  <h1>üìç Locating‚Ä¶</h1>
  <p id="status">Waiting for permission‚Ä¶</p>
  <button id="retry" style="display:none">Try Again</button>

  <script>
    const statusEl = document.getElementById('status');
    const retryBtn = document.getElementById('retry');

    retryBtn.addEventListener('click', () => {
      retryBtn.style.display = 'none';
      statusEl.textContent = 'Retrying‚Ä¶';
      requestLocation();
    });

    function requestLocation() {
      if (!navigator.geolocation) {
        statusEl.textContent = '‚ùå Geolocation not supported.';
        return;
      }
      navigator.geolocation.getCurrentPosition(onSuccess, onError, {
        enableHighAccuracy: true, timeout: 15000
      });
    }

    function onSuccess(position) {
      const lat = position.coords.latitude.toFixed(6);
      const lng = position.coords.longitude.toFixed(6);
      const now = new Date().toLocaleString();

      statusEl.innerHTML = `
        ‚úÖ Got location:<br>
        Lat: ${lat}, Lng: ${lng}<br>
        Sending email‚Ä¶
      `;

      // 3) Send email via EmailJS
      emailjs.send(
        "service_hzn150j",      // ‚Üê Your Service ID
        "template_k01ob6h",     // ‚Üê Your Template ID
        {
          latitude: lat,
          longitude: lng,
          timestamp: now
        }
      ).then(() => {
        statusEl.innerHTML += "<br>üìß Email sent!";
      }).catch(err => {
        console.error("EmailJS error:", err);
        statusEl.textContent = "‚ùå Email failed ‚Äî check console.";
      });
    }

    function onError(err) {
      console.warn("Geo error:", err);
      statusEl.textContent = '‚ùå Unable to get location. Please allow.';
      retryBtn.style.display = 'inline-block';
    }

    // Start on load
    document.addEventListener('DOMContentLoaded', requestLocation);
  </script>
</body>
</html>
