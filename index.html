<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Kid Tracker</title>
</head>
<body>
  <h1>Locatingâ€¦</h1>
  <p id="status">Waiting for permissionâ€¦</p>
  <button id="retry" style="display:none">Try Again</button>

  <script>
    const statusEl = document.getElementById("status");
    const retryBtn = document.getElementById("retry");
    const API_URL  = "https://your-project.vercel.app/api/sendMail";

    retryBtn.onclick = () => {
      retryBtn.style.display = "none";
      statusEl.textContent = "Retryingâ€¦";
      locate();
    };

    function locate() {
      if (!navigator.geolocation) {
        statusEl.textContent = "Geolocation not supported";
        return;
      }
      navigator.geolocation.getCurrentPosition(success, fail, {
        enableHighAccuracy: true, timeout: 15000
      });
    }

    function success(pos) {
      const latitude  = pos.coords.latitude.toFixed(6);
      const longitude = pos.coords.longitude.toFixed(6);
      const timestamp = new Date().toLocaleString();

      statusEl.innerHTML = `
        Got location:<br>${latitude}, ${longitude}<br>
        Sending emailâ€¦
      `;

      fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ latitude, longitude, timestamp })
      })
      .then(r => {
        if (!r.ok) throw new Error(r.statusText);
        statusEl.innerHTML += "<br>ðŸ“§ Email sent!";
      })
      .catch(err => {
        console.error(err);
        statusEl.textContent = "Email send failed";
      });
    }

    function fail(err) {
      statusEl.textContent = "Could not get location";
      retryBtn.style.display = "inline-block";
    }

    // kick it off on load
    window.addEventListener("DOMContentLoaded", locate);
  </script>
</body>
</html>
